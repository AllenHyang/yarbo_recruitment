# AWS Amplify SSR 部署验证清单

## 🚀 部署前检查

### 代码准备
- [ ] 所有代码已提交到 Git
- [ ] `next.config.ts` 已移除 `output: 'export'`
- [ ] `amplify.yml` 已更新为 SSR 配置
- [ ] 环境变量示例文件已创建

### 本地测试
- [ ] `npm run build` 构建成功
- [ ] `npm run start` 生产模式运行正常
- [ ] 验证码功能在本地正常工作

## 🔧 AWS Amplify 配置

### 环境变量设置
在 AWS Amplify 控制台添加以下环境变量：

#### 必需的环境变量
- [ ] `NEXT_PUBLIC_SUPABASE_URL`
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- [ ] `SUPABASE_SERVICE_ROLE_KEY`
- [ ] `NEXT_PUBLIC_APP_URL`

#### 可选的环境变量
- [ ] `SMTP_HOST`
- [ ] `SMTP_PORT`
- [ ] `SMTP_USER`
- [ ] `SMTP_PASS`
- [ ] `EMAIL_FROM`

### 构建设置
- [ ] 确认 "Build type" 为 "SSR (Server-Side Rendering)"
- [ ] 确认构建命令正确
- [ ] 确认输出目录为 `.next`

## ✅ 部署后验证

### 基础功能测试

#### 1. 页面访问测试
- [ ] 首页能正常访问
- [ ] 职位列表页正常显示
- [ ] 登录页面加载正常
- [ ] 注册页面加载正常
- [ ] 职位详情页正常显示

#### 2. API Routes 测试
- [ ] `/api/captcha/generate` 返回 200
- [ ] `/api/captcha/verify` 正确验证
- [ ] API 错误处理正常

#### 3. 验证码功能测试
- [ ] 点击"获取验证码"按钮
- [ ] 验证码成功生成并显示
- [ ] 输入正确验证码能通过验证
- [ ] 输入错误验证码被正确拒绝

#### 4. 性能测试
- [ ] 首页加载时间 < 3秒
- [ ] API 响应时间 < 1秒
- [ ] 静态资源正确缓存

### 使用测试工具

#### 命令行测试
```bash
# 运行部署测试脚本
node test-deployment.js https://your-app.amplifyapp.com
```

#### 浏览器测试
1. 打开 `test-api-endpoints.html`
2. 输入部署后的 URL
3. 运行所有测试

### 高级功能测试

#### 5. Supabase 集成
- [ ] 数据库连接正常
- [ ] 实时订阅功能正常
- [ ] 文件上传功能正常

#### 6. 用户认证
- [ ] 用户注册流程完整
- [ ] 登录/登出功能正常
- [ ] 权限控制正确

#### 7. 邮件功能（如已配置）
- [ ] 注册确认邮件发送
- [ ] 密码重置邮件发送
- [ ] 通知邮件发送

## 🐛 常见问题排查

### 如果页面显示 404
1. 检查 Amplify 构建类型是否为 SSR
2. 检查 `amplify.yml` 配置是否正确
3. 查看 CloudWatch 日志

### 如果 API 返回 500
1. 检查环境变量是否正确设置
2. 查看 Lambda 函数日志
3. 确认数据库连接正常

### 如果验证码不工作
1. 检查浏览器控制台错误
2. 确认 API Routes 可访问
3. 清除浏览器缓存重试

## 📊 监控和维护

### 设置监控
- [ ] 配置 CloudWatch 告警
- [ ] 设置错误通知
- [ ] 配置性能监控

### 定期检查
- [ ] 每周查看错误日志
- [ ] 每月查看 AWS 账单
- [ ] 定期更新依赖包

## 🎉 部署成功标志

当以下条件都满足时，可以认为部署成功：
- ✅ 所有页面正常访问
- ✅ API Routes 正常工作
- ✅ 验证码功能正常
- ✅ 用户可以正常注册/登录
- ✅ 性能达到预期标准

## 📝 备注

部署完成时间：_______________
部署版本号：_________________
部署负责人：_________________

特殊说明：
_____________________________
_____________________________
_____________________________