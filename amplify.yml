version: 1
applications:
  - appRoot: yarbo-app
    frontend:
      phases:
        preBuild:
          commands:
            - npm ci
        build:
          commands:
            - npm run build
            - mkdir -p .amplify-hosting
            - echo '{"version":1,"imageUri":"public.ecr.aws/lambda/nodejs:18","routes":[{"src":"/_next/static/(.*)","dest":"/_next/static/$1","headers":{"cache-control":"public,max-age=31536000,immutable"}},{"src":"/_next/image(.*)","dest":"/_next/image$1"},{"src":"/api/(.*)","dest":"/api/$1"},{"src":"/(.*)", "dest":"/"}],"buildCommand":"npm run build","outputDirectory":".next","framework":"nextjs"}' > .amplify-hosting/deploy-manifest.json
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - .next/cache/**/*